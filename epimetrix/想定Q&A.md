# 想定質問と回答集 (Q&A) - EpiMetrix案件

本資料は、商談や面接で現場エンジニアから聞かれる可能性が高い技術的な質問と、それに対する回答をまとめたものです。医療業界特有の要件（HIPAA、セキュリティ、ガバナンス等）に関する質問も含めています。

## 1. 医療業界・コンプライアンス関連

### Q1-1: HIPAAコンプライアンスはどのように確保していますか？

**A**: HIPAAコンプライアンスは以下のように確保しています：

1. **AWS HIPAA Eligible Services**: HIPAA Eligible Servicesのみを使用し、AWS Business Associate Agreement (BAA) を締結しています。

2. **データ暗号化**: 
   - 転送時: TLS 1.3を使用したHTTPS通信、AWS PrivateLinkによるプライベート接続
   - 保存時: S3 SSE-KMS、RDS暗号化、EBS暗号化

3. **アクセス制御**: 
   - 最小権限の原則に基づくIAMポリシー
   - ロールベースアクセス制御（RBAC）
   - 多要素認証（MFA）の必須化

4. **監査ログ**: 
   - CloudTrailによるAPI呼び出しの記録
   - VPC Flow Logsによるネットワークトラフィックの記録
   - データベース監査ログの有効化

5. **データの匿名化・マスキング**: 開発/ステージング環境では、個人を特定できる情報（PII）や保護された医療情報（PHI）をマスキングします。

6. **データ保持・削除**: 法的要件に基づくデータ保持期間の管理と、期限切れデータの安全な削除を実施します。

---

### Q1-2: 日本の医療情報システム安全管理指針にはどのように対応していますか？

**A**: 日本の医療情報システム安全管理指針には以下のように対応しています：

1. **アクセス制御**: 
   - 認証機能（ID/パスワード、MFA）
   - 認可機能（ロールベースアクセス制御）
   - アクセスログの記録

2. **データ保護**: 
   - 暗号化（転送時・保存時）
   - バックアップと復旧
   - データの完全性確保

3. **セキュリティ監視**: 
   - 不正アクセスの検出（GuardDuty）
   - セキュリティイベントの監視（Security Hub）
   - インシデント対応プロセス

4. **物理的セキュリティ**: AWSデータセンターの物理的セキュリティに依存（AWSが管理）

5. **組織的安全管理**: 
   - セキュリティポリシーの文書化
   - 従業員のセキュリティ教育
   - 定期的なセキュリティ監査

実際の詳細な要件については、商談の場で確認したいと思います。

---

### Q1-3: 医療データの保存場所について、日本国内に限定する必要はありますか？

**A**: データの保存場所については、法的要件とコンプライアンス要件に基づいて決定する必要があります：

1. **AWS東京リージョン**: 日本国内のデータ所在地要件に対応するため、東京リージョン（ap-northeast-1）を使用することを推奨します。

2. **クロスリージョンレプリケーション**: 災害復旧のため、別リージョンへのバックアップを検討する場合、データ所在地要件を確認する必要があります。

3. **AWS PrivateLink**: プライベート接続を使用し、データ転送のセキュリティを確保します。

4. **データ所在地要件**: 実際のデータ所在地要件（日本の個人情報保護法、医療情報システム安全管理指針等）については、商談の場で詳細を確認したいと思います。

---

## 2. セキュリティ関連

### Q2-1: セキュリティインシデントが発生した場合の対応プロセスはどのようになっていますか？

**A**: セキュリティインシデント対応プロセスは以下の通りです：

1. **インシデント検出**: 
   - GuardDutyによる脅威検出
   - CloudWatch Alarmsによる異常検出
   - Security Hubによる統合的なセキュリティイベントの可視化

2. **トリアージ**: 
   - インシデントの重大度を判定（Critical、High、Medium、Low）
   - 影響範囲の特定

3. **対応**: 
   - オンフコール担当者のエスカレーション
   - 影響を受けたリソースの隔離
   - 必要に応じてAWSサポートへの連絡

4. **事後分析**: 
   - Postmortemの実施
   - 根本原因分析（RCA）
   - 再発防止策の検討

5. **報告**: 
   - 関係者への報告
   - 必要に応じて規制当局への報告（HIPAA要件等）

詳細なインシデント対応プロセスについては、商談の場で確認したいと思います。

---

### Q2-2: セキュリティ監査はどのように実施していますか？

**A**: セキュリティ監査は以下のように実施します：

1. **自動監査**: 
   - AWS Configによる設定変更の追跡
   - CloudTrailによるAPI呼び出しの記録
   - Security Hubによるコンプライアンスチェック

2. **脆弱性スキャン**: 
   - ECR統合スキャンによるコンテナイメージの脆弱性スキャン
   - AWS InspectorによるEC2インスタンスの脆弱性評価

3. **定期的なレビュー**: 
   - 月次でのセキュリティ設定レビュー
   - 四半期ごとのWell-Architected Review
   - 年次での包括的なセキュリティ監査

4. **監査ログの保持**: 
   - CloudTrailログは90日間保持（必要に応じてS3にアーカイブ）
   - データベース監査ログは30日間保持（要件に応じて調整）

5. **外部監査**: 
   - 必要に応じて外部セキュリティ監査の実施
   - コンプライアンス監査（SOC 2、ISO 27001等）

---

### Q2-3: データの匿名化・マスキングはどのように実施していますか？

**A**: データの匿名化・マスキングは以下のように実施します：

1. **開発/ステージング環境**: 
   - 個人を特定できる情報（PII）や保護された医療情報（PHI）をマスキング
   - テストデータの生成（合成データ、ダミーデータ）

2. **データマスキングツール**: 
   - AWS DMS（Database Migration Service）のデータ変換機能
   - カスタムスクリプトによるマスキング

3. **データ分類**: 
   - データの機密性レベルを分類（機密、重要、一般）
   - データ分類に基づくアクセス制御

4. **匿名化手法**: 
   - 個人識別子の削除・置換
   - 日付の一般化（年のみ、月のみ等）
   - 数値の範囲化（年齢を年代に、収入を範囲に等）

実際のマスキング要件については、商談の場で確認したいと思います。

---

## 3. MLOps関連

### Q3-1: SageMakerを使用する理由を教えてください。KubeflowやMLflowではダメですか？

**A**: SageMakerを選定した主な理由は以下の通りです：

1. **HIPAA対応**: SageMakerはHIPAA Eligible Serviceで、医療データの取り扱いに対応可能です。KubeflowやMLflowはセルフホスト型で、HIPAA対応を自前で実装する必要があります。

2. **マネージドサービス**: モデル開発からデプロイまで、MLライフサイクル全体をマネージドサービスでサポートします。運用負荷を大幅に軽減できます。

3. **ガバナンス機能**: SageMaker Model Registry、Lineage等、モデル管理とガバナンス機能が充実しています。医療業界ではモデルの追跡可能性（Traceability）が重要です。

4. **AWS統合**: S3、RDS、Lambda等、AWSサービスとの統合がシームレスです。

5. **モデル監視**: SageMaker Model Monitorにより、モデルの継続的監視が可能です。

ただし、MLflowはSageMakerと併用して実験管理に使用することも検討可能です。

---

### Q3-2: モデルのガバナンスはどのように実施していますか？

**A**: モデルのガバナンスは以下のように実施します：

1. **モデルレジストリ**: 
   - SageMaker Model RegistryまたはMLflow Model Registryを使用
   - モデルのバージョン管理とメタデータ管理

2. **モデルラインジ（Model Lineage）**: 
   - モデルの開発からデプロイまでの履歴を追跡
   - 使用したデータセット、ハイパーパラメータ、実験結果の記録

3. **モデル承認プロセス**: 
   - モデルデプロイ前の承認ゲート
   - 手動承認または自動承認（評価指標に基づく）

4. **モデル監視**: 
   - モデルの継続的監視（データドリフト、モデルドリフト等）
   - モデルパフォーマンスの追跡

5. **説明可能性**: 
   - SHAP値、LIME等、モデルの解釈可能性を確保
   - 医療業界ではモデルの説明可能性が重要

6. **監査ログ**: 
   - モデルのデプロイ、更新、削除のログ記録
   - CloudTrailによるアクセスログ

---

### Q3-3: MLOpsパイプラインの構成を教えてください。

**A**: MLOpsパイプラインは以下のように構成します：

```
Data Sources → Data Preparation → Feature Engineering → Model Training
                                                              ↓
                                              Model Evaluation & Validation
                                                              ↓
                                              Model Registry (SageMaker/MLflow)
                                                              ↓
                                              Model Deployment (A/B Testing)
                                                              ↓
                                              Model Monitoring & Retraining
```

1. **データ準備**: SageMaker Data Wrangler、Great Expectations等を使用
2. **特徴量エンジニアリング**: SageMaker Feature Store（オフライン/オンラインストア）
3. **モデル訓練**: SageMaker Training Jobs（分散訓練、GPUインスタンス）
4. **モデル評価**: SageMaker Model Evaluation、カスタム評価指標
5. **モデルレジストリ**: SageMaker Model Registry、モデルバージョン管理
6. **モデルデプロイ**: SageMaker Endpoints（リアルタイム推論）、SageMaker Batch Transform（バッチ推論）
7. **モデル監視**: SageMaker Model Monitor（データドリフト、モデルドリフト）
8. **再訓練**: モデル監視の結果に基づく自動/手動再訓練

---

## 4. HPC環境関連

### Q4-1: HPC環境は必ず必要ですか？それとも要件に応じて判断しますか？

**A**: HPC環境は要件に応じて判断します。以下のような場合にHPC環境が必要です：

1. **大規模科学計算**: ゲノム解析、分子動力学シミュレーション等、大規模な科学計算が必要な場合

2. **大規模ML訓練**: 深層学習モデルの大規模分散訓練（データセットがTB規模、GPU複数台が必要等）

3. **高パフォーマンス処理**: 高スループット・低レイテンシが要求される処理（医学画像処理、リアルタイム解析等）

4. **並列処理**: 大規模な並列処理が必要な場合（Monte Carloシミュレーション等）

通常のML訓練や中規模データ処理では、通常のEC2インスタンスやSageMakerで対応可能です。HPC環境が必要かどうかは、実際のワークロード要件を確認して判断します。

商談の場で、実際のワークロード要件を確認したいと思います。

---

### Q4-2: AWS ParallelClusterを選んだ理由を教えてください。

**A**: AWS ParallelClusterを選定した理由は以下の通りです：

1. **マネージドサービス**: HPCクラスターの構築・管理が容易で、運用負荷を軽減できます。

2. **スケーラビリティ**: オンデマンドインスタンスとSpot Instancesの混在が可能で、需要に応じて自動スケーリングします。

3. **コスト最適化**: Spot Instancesの活用により、最大90%のコスト削減が可能です（インタラプト可能なジョブの場合）。

4. **高性能ストレージ**: FSx for Lustre統合により、高スループット・低レイテンシのストレージを利用できます。

5. **ジョブスケジューラー**: Slurm、SGE、Torque等、多様なジョブスケジューラーに対応しています。

6. **AWS統合**: AWSサービス（S3、EC2、VPC等）との統合がシームレスです。

セルフマネージドHPCクラスターと比較して、構築・運用負荷を大幅に軽減できます。

---

### Q4-3: GPUインスタンス（P3、P4、P5）の選定基準を教えてください。

**A**: GPUインスタンスの選定基準は以下の通りです：

1. **ワークロードの特性**: 
   - **深層学習**: P3 (V100)、P4 (A100)、P5 (H100)
   - **科学計算**: P3、P4、P5（用途に応じて選択）

2. **パフォーマンス要件**: 
   - **高パフォーマンス**: P5 (H100) - 最新のGPUで最高のパフォーマンス
   - **標準**: P4 (A100) - バランスの取れたパフォーマンス
   - **コスト効率**: P3 (V100) - 十分なパフォーマンスでコストが低い

3. **コスト制約**: 
   - 予算に応じてP3、P4、P5を選択
   - Spot Instancesの活用により、コストを大幅に削減

4. **利用可能性**: 
   - リージョンによって利用可能なインスタンスタイプが異なる
   - 東京リージョンでの利用可能インスタンスを確認

実際のワークロード要件とコスト制約を確認して、最適なインスタンスタイプを選定します。

---

## 5. インフラ・運用関連

### Q5-1: ECSとEKSのどちらを選ぶべきか、判断基準を教えてください。

**A**: ECSとEKSの選定基準は以下の通りです：

**ECSを選ぶ場合**:
- シンプルなワークロード（マイクロサービス、API、Webアプリケーション等）
- チームのKubernetesスキルが限定的
- AWSサービス中心の構成
- コストを最優先する場合

**EKSを選ぶ場合**:
- 複雑なワークロード（MLOps、データ処理パイプライン等）
- MLOps機能が必要な場合（Kubeflow Pipelines等）
- Kubernetesエコシステム（Helm、Istio、Prometheus等）を活用したい場合
- 将来的なマルチクラウド展開を検討している場合

**両方の併用**:
- 要件に応じてECSとEKSを併用することも可能（シンプルなワークロードはECS、複雑なワークロードはEKS）

実際の要件とチームのスキルレベルを確認して、最適な選択をします。

---

### Q5-2: バックアップ戦略を教えてください。

**A**: バックアップ戦略は以下の通りです：

1. **RDS/Aurora**: 
   - 自動スナップショットを1日1回、7日間保持
   - マルチAZ構成で高可用性を確保
   - クロスリージョンレプリケーション（災害復旧用）

2. **S3**: 
   - バージョニングを有効化
   - クロスリージョンレプリケーション（災害復旧用）
   - S3 Lifecycle Policiesによる自動アーカイブ（Glacier）

3. **EBS**: 
   - EBSスナップショットを定期取得（日次または週次）
   - アプリケーション固有のスナップショット戦略

4. **Kubernetesリソース**: 
   - etcdスナップショットを定期取得
   - Velero等のバックアップツールを使用

5. **Terraform状態**: 
   - Terraform状態ファイルはS3に保存し、バージョニングを有効化
   - DynamoDBでロック管理

6. **バックアップテスト**: 
   - 定期的にバックアップのリストアテストを実施（月次または四半期ごと）

医療データのバックアップ要件（保持期間、復旧時間等）については、商談の場で確認したいと思います。

---

### Q5-3: 災害復旧計画はどのように策定していますか？

**A**: 災害復旧計画は以下のように策定します：

1. **RTO/RPO定義**: 
   - Recovery Time Objective (RTO): 復旧時間の目標値（例: 4時間、24時間等）
   - Recovery Point Objective (RPO): データ損失の許容範囲（例: 1時間、1日等）

2. **DRサイト**: 
   - 別リージョンへの災害時復旧手順を文書化
   - クロスリージョンレプリケーションの設定
   - 定期的なDRテストの実施

3. **IaC活用**: 
   - Terraform等のIaCを使用し、災害時にも迅速にインフラを再構築できるようにする

4. **データ復旧**: 
   - バックアップからのデータ復旧手順を文書化
   - 復旧手順のテストを定期的に実施

5. **コミュニケーション**: 
   - 災害時のコミュニケーションプランを策定
   - 関係者への通知プロセスを定義

詳細なRTO/RPOの目標値については、商談の場で確認したいと思います。

---

## 6. コスト最適化関連

### Q6-1: コスト最適化の戦略を教えてください。

**A**: コスト最適化の戦略は以下の通りです：

1. **Right Sizing**: 
   - CloudWatchメトリクスでリソース使用率を監視
   - インスタンスサイズを最適化（過剰なリソースの削減）

2. **Reserved Instances / Savings Plans**: 
   - 本番環境では1年/3年のReserved InstancesまたはSavings Plansを検討
   - 最大70%のコスト削減が可能

3. **Spot Instances**: 
   - 開発環境、バッチ処理、HPCワークロードにはSpot Instancesを使用
   - 最大90%のコスト削減が可能（インタラプト可能なジョブの場合）

4. **S3 Intelligent-Tiering**: 
   - アクセスパターンに応じた自動階層化
   - 古いデータは自動でGlacierにアーカイブ

5. **Auto Scaling**: 
   - Horizontal Pod Autoscaler、Cluster Autoscaler等を使用
   - 需要に応じてリソースを自動スケーリング

6. **不要リソースの削除**: 
   - 未使用のEBSボリューム、スナップショット、AMIの削除
   - 未使用のElastic IPの解放

7. **タグ戦略**: 
   - プロジェクト、環境、コストセンター別にタグ付け
   - コスト配分を明確化

---

## 7. その他

### Q7-1: この設計で懸念点やリスクはありますか？

**A**: 以下の点が懸念点・リスクとして考えられます：

1. **HIPAAコンプライアンス**: 
   - HIPAA要件の完全な理解と実装が必要
   - 定期的なコンプライアンス監査が必要

2. **データセキュリティ**: 
   - 医療データの保護が最優先
   - データ漏洩のリスクを常に考慮

3. **学習コスト**: 
   - SageMaker、Kubernetes、Terraform等の学習コストが高い可能性
   - 段階的な導入とトレーニングが必要

4. **運用負荷**: 
   - 初期構築後の運用負荷が高い可能性
   - 自動化とマネージドサービスの活用で軽減

5. **コスト**: 
   - HIPAA対応、マルチAZ構成、高可用性構成により、コストが高くなる可能性
   - コスト最適化戦略で対応

6. **ベンダーロックイン**: 
   - AWSサービスに依存する部分がある
   - オープンスタンダード（Kubernetes等）の採用で軽減

これらの懸念点については、段階的な導入と継続的な改善で対応していきます。

---

### Q7-2: 今後の拡張性はどう考えていますか？

**A**: 今後の拡張性について、以下の点を考慮しています：

1. **マルチクラウド対応**: 
   - Terraform等のマルチクラウド対応ツールを採用
   - 将来的なマルチクラウド展開に対応可能

2. **スケーラビリティ**: 
   - Kubernetes、ECSの自動スケーリング機能により、需要の増加に対応可能
   - HPC環境も必要に応じてスケール可能

3. **AI/ML機能の強化**: 
   - SageMaker、Kubeflow等の導入により、より高度なML機能を追加可能
   - リアルタイム推論の拡充

4. **エッジコンピューティング**: 
   - 医療機器との連携拡張を考慮し、AWS IoT Greengrass等の検討が可能

5. **モジュール化**: 
   - IaCのモジュール化により、新機能の追加が容易

具体的な拡張計画については、商談の場で確認したいと思います。

---

## 8. 商談で確認したい事項

### Q8-1: 確認したい技術的な詳細事項

1. **既存インフラの状況**: 現在のインフラ構成、使用しているツール、課題等

2. **HIPAA要件**: 具体的なHIPAA要件、コンプライアンス要件、監査要件等

3. **データ要件**: データの種類、データ量、データ保存期間、データ所在地要件等

4. **MLOps要件**: モデル訓練の頻度、推論方法（リアルタイム/バッチ）、モデル監視要件等

5. **HPC要件**: HPC環境が必要かどうか、ワークロードの特性、パフォーマンス要件等

6. **セキュリティ要件**: セキュリティポリシー、アクセス制御要件、監査要件等

7. **コスト制約**: 予算、コスト最適化の優先度等

8. **運用体制**: On-call体制、運用チームの規模、スキルレベル等

9. **SLO/SLI**: 可用性、レイテンシ、エラー率の目標値等

10. **災害復旧要件**: RTO/RPOの目標値、DRテストの頻度等

---

## 参考資料

- AWS Well-Architected Framework
- AWS HIPAA Eligible Services
- AWS Security Best Practices
- MLOps Best Practices
- HPC on AWS Best Practices
- Healthcare Information System Security Guidelines（日本の医療情報システム安全管理指針）
