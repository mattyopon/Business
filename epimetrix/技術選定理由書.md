# 技術選定理由書 - EpiMetrix案件

## 1. 概要

本資料は、医療業界向けクラウドインフラ構築における技術選定の理由と根拠を説明します。各技術スタックを選定した背景、考慮した代替案、選定基準を明確にしています。医療業界特有の要件（セキュリティ、コンプライアンス、ガバナンス）も考慮しています。

## 2. クラウドプラットフォーム選定

### 2.1 AWS の選定理由

**選定技術**: Amazon Web Services (AWS)

**選定理由**:
1. **HIPAA対応サービス**: AWS HIPAA Eligible Servicesが提供されており、医療データの取り扱いに対応可能
2. **高いセキュリティ**: IAM、KMS、GuardDuty等、医療業界レベルのセキュリティ機能が標準提供
3. **コンプライアンス対応**: SOC 2、ISO 27001、HIPAA等、各種コンプライアンス要件に対応
4. **豊富なマネージドサービス**: EKS、ECS、RDS、SageMaker等、多様なマネージドサービスにより運用負荷を軽減
5. **高可用性とスケーラビリティ**: マルチAZ対応、自動スケーリング機能が充実
6. **国内リージョン対応**: 東京リージョン（ap-northeast-1）が存在し、データ所在地要件に対応可能

**代替案との比較**:
- **Microsoft Azure**: AzureもHIPAA対応だが、日本国内での医療業界の事例がAWSと比較して少ない
- **Google Cloud Platform (GCP)**: GCPもHIPAA対応だが、日本国内での医療業界の事例がAWSと比較して少ない
- **オンプレミス**: セキュリティ面では有利だが、スケーラビリティと運用負荷の観点から不向き

**選定基準**:
- HIPAA等のコンプライアンス対応
- セキュリティ機能の充実度
- マネージドサービスの充実度
- コスト効率
- スケーラビリティ
- 日本国内での実績

## 3. コンテナ環境選定

### 3.1 ECS/EKS の選定理由

**選定技術**: Amazon ECS / Amazon EKS（要件に応じて選択）

**選定理由（ECSの場合）**:
1. **シンプルさ**: Kubernetesと比較してシンプルで、学習コストが低い
2. **AWS統合**: AWSサービスとの統合が非常に良好
3. **運用負荷**: マネージドサービスで、運用負荷が低い
4. **コスト**: EKSと比較してコストが低い

**選定理由（EKSの場合）**:
1. **標準化**: KubernetesはCNCF標準で、ベンダーロックインを回避
2. **エコシステム**: Helm、Istio、Prometheus等、豊富なKubernetesエコシステムを活用可能
3. **MLOps統合**: Kubeflow Pipelines等、MLOpsツールとの統合が容易
4. **スケーラビリティ**: HPA、Cluster Autoscaler等、柔軟なスケーリングが可能

**選定基準**:
- 要件の複雑さ（シンプルなワークロードはECS、複雑なワークロードはEKS）
- MLOps機能の必要性（Kubeflow Pipelines等が必要な場合はEKS）
- チームのスキルレベル
- コスト制約

## 4. MLOpsパイプライン選定

### 4.1 SageMaker の選定理由

**選定技術**: Amazon SageMaker

**選定理由**:
1. **マネージドサービス**: モデル開発からデプロイまで、MLライフサイクル全体をサポート
2. **ガバナンス機能**: SageMaker Model Registry、Lineage等、モデル管理とガバナンス機能が充実
3. **セキュリティ**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能
4. **統合性**: AWSサービス（S3、RDS、Lambda等）との統合がシームレス
5. **自動化**: SageMaker Pipelinesにより、MLワークフローの自動化が可能
6. **モデル監視**: SageMaker Model Monitorにより、モデルの継続的監視が可能

**代替案との比較**:
- **Kubeflow**: Kubernetesネイティブで柔軟だが、セルフホスト型で運用負荷が高い
- **MLflow**: オープンソースで柔軟だが、マネージドサービスと比較して運用負荷が高い
- **Databricks**: 強力だが、AWS環境との統合がSageMakerほどシームレスではない

**選定基準**:
- マネージドサービスの優先
- HIPAA対応
- AWSサービスとの統合性
- ガバナンス機能の充実度
- 運用負荷の軽減

### 4.2 MLflow の選定理由（併用）

**選定技術**: MLflow（SageMakerと併用）

**選定理由**:
1. **オープンソース**: コストがかからず、カスタマイズ可能
2. **実験管理**: モデル実験の管理と比較が容易
3. **モデルレジストリ**: MLflow Model Registryによるモデルバージョン管理
4. **マルチフレームワーク**: TensorFlow、PyTorch、Scikit-learn等、多様なMLフレームワークに対応
5. **SageMaker統合**: SageMakerと統合して使用可能

**選定基準**:
- コスト効率
- 柔軟性とカスタマイズ性
- オープンスタンダード
- SageMakerとの統合性

## 5. HPC環境選定

### 5.1 AWS ParallelCluster の選定理由

**選定技術**: AWS ParallelCluster

**選定理由**:
1. **マネージドサービス**: HPCクラスターの構築・管理が容易
2. **スケーラビリティ**: オンデマンドインスタンスとSpot Instancesの混在が可能
3. **コスト最適化**: Spot Instancesの活用により、コストを大幅に削減可能
4. **高性能ストレージ**: FSx for Lustre統合により、高スループット・低レイテンシのストレージを利用可能
5. **ジョブスケジューラー**: Slurm、SGE、Torque等、多様なジョブスケジューラーに対応
6. **自動スケーリング**: ジョブキューに基づく自動スケーリング

**代替案との比較**:
- **AWS Batch**: バッチジョブ向けだが、HPCクラスター管理機能がParallelClusterほど充実していない
- **セルフマネージドHPC**: 柔軟だが、構築・運用負荷が高い
- **GCP Cloud HPC**: 強力だが、AWS環境との統合がParallelClusterほどシームレスではない

**選定基準**:
- 運用負荷の軽減
- コスト効率
- スケーラビリティ
- 高性能ストレージの統合性
- AWSサービスとの統合性

### 5.2 GPUインスタンス選定

**選定技術**: P3 (V100), P4 (A100), P5 (H100)（用途に応じて選択）

**選定理由**:
1. **深層学習**: P3/P4/P5は深層学習に最適化されたGPUインスタンス
2. **科学計算**: HPCワークロードにも対応
3. **パフォーマンス**: V100、A100、H100は最新のGPUで、高いパフォーマンスを提供
4. **コスト効率**: Spot Instancesと組み合わせることで、コストを大幅に削減可能

**選定基準**:
- ワークロードの特性（深層学習、科学計算等）
- パフォーマンス要件
- コスト制約

### 5.3 FSx for Lustre の選定理由

**選定技術**: FSx for Lustre

**選定理由**:
1. **高性能**: 高スループット（最大数GB/s）、低レイテンシ
2. **並列ファイルシステム**: 複数のノードから同時アクセス可能
3. **S3統合**: S3との統合により、データの取り込み・出力が容易
4. **スケーラビリティ**: ペタバイト規模のデータに対応可能
5. **コスト効率**: 使用量に応じた従量課金

**選定基準**:
- パフォーマンス要件（スループット、レイテンシ）
- データ量
- 並列アクセス要件
- S3統合の必要性

## 6. Infrastructure as Code (IaC) 選定

### 6.1 Terraform の選定理由

**選定技術**: Terraform

**選定理由**:
1. **マルチクラウド対応**: 将来的なマルチクラウド展開に対応可能
2. **宣言的言語**: HCL（HashiCorp Configuration Language）で読みやすく、保守しやすい
3. **豊富なプロバイダー**: AWS、Kubernetes、SageMaker等、多様なリソースを管理可能
4. **状態管理**: Terraform状態ファイルにより、現在のインフラ状態を追跡可能
5. **Plan機能**: 実行前の変更内容確認により、安全性が高い
6. **モジュール化**: 再利用可能なモジュール設計により、コードの保守性が高い

**代替案との比較**:
- **AWS CloudFormation**: AWS専用で強力だが、マルチクラウド対応ができない
- **AWS CDK**: TypeScript/Python等で定義できるが、学習コストが高い

**選定基準**:
- マルチクラウド対応性
- 学習コスト
- コミュニティとサポート
- コードの保守性
- 状態管理機能

## 7. セキュリティ・ガバナンス選定

### 7.1 AWS Secrets Manager の選定理由

**選定技術**: AWS Secrets Manager

**選定理由**:
1. **自動ローテーション**: データベース認証情報等の自動ローテーション
2. **AWS統合**: Lambda、RDS等との統合が容易
3. **暗号化**: KMSによる暗号化が標準
4. **監査**: CloudTrailによるアクセスログ
5. **HIPAA対応**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能

**代替案との比較**:
- **HashiCorp Vault**: より高機能だが、セルフホスト型で運用負荷が高い
- **AWS Systems Manager Parameter Store**: よりシンプルで低コストだが、自動ローテーション機能がない

**選定基準**:
- 自動ローテーション機能
- AWSサービスとの統合性
- HIPAA対応
- 運用負荷の軽減

### 7.2 AWS KMS の選定理由

**選定技術**: AWS Key Management Service (KMS)

**選定理由**:
1. **マネージドサービス**: キー管理の運用負荷を軽減
2. **暗号化**: データの転送時・保存時の暗号化に使用
3. **アクセス制御**: IAMポリシーによるキーへのアクセス制御
4. **監査**: CloudTrailによるキー使用ログ
5. **HIPAA対応**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能

**選定基準**:
- マネージドサービスの優先
- HIPAA対応
- アクセス制御機能
- 監査機能

### 7.3 AWS GuardDuty の選定理由

**選定技術**: Amazon GuardDuty

**選定理由**:
1. **脅威検出**: 機械学習ベースの脅威検出
2. **マネージドサービス**: 設定が容易で、運用負荷が低い
3. **統合性**: Security Hub、EventBridge等との統合が容易
4. **コスト効率**: 分析するログ量に基づく従量課金
5. **HIPAA対応**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能

**選定基準**:
- 脅威検出機能の充実度
- HIPAA対応
- 運用負荷の軽減
- AWSサービスとの統合性

## 8. 監視・ロギング選定

### 8.1 Amazon CloudWatch の選定理由

**選定技術**: Amazon CloudWatch

**選定理由**:
1. **AWSネイティブ**: AWSリソースのメトリクスが自動で収集される
2. **統合性**: 他のAWSサービス（Lambda、ECS、RDS、SageMaker等）との統合がシームレス
3. **アラート**: CloudWatch Alarmsによるアラート設定が容易
4. **ログ管理**: CloudWatch Logsによる統合ログ管理
5. **HIPAA対応**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能

**選定基準**:
- AWSサービスとの統合性
- HIPAA対応
- 運用負荷の軽減
- コスト効率

### 8.2 Prometheus + Grafana の選定理由（オプション）

**選定技術**: Prometheus + Grafana（ECS/EKSを使用する場合）

**選定理由**:
1. **Kubernetes標準**: Kubernetesのメトリクス収集に標準的に使用される
2. **柔軟なクエリ**: PromQLによる柔軟なクエリが可能
3. **豊富な可視化**: Grafanaによる高機能なダッシュボード
4. **オープンソース**: コストがかからず、カスタマイズ可能

**選定基準**:
- ECS/EKSを使用する場合の追加監視ツール
- 柔軟性とカスタマイズ性
- コスト効率

## 9. データストレージ選定

### 9.1 Amazon S3 の選定理由（データレイク）

**選定技術**: Amazon S3（医療データの保存時は暗号化必須）

**選定理由**:
1. **スケーラビリティ**: 無制限のストレージ容量、99.999999999%（11 9's）の耐久性
2. **コスト効率**: ストレージクラス（Standard、Intelligent-Tiering、Glacier等）により、コスト最適化が可能
3. **暗号化**: SSE-KMSによる暗号化が標準サポート（医療データ必須）
4. **アクセス制御**: IAM、バケットポリシー、VPCエンドポイントによるアクセス制御
5. **監査**: CloudTrail、S3アクセスログによる監査
6. **HIPAA対応**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能

**選定基準**:
- スケーラビリティ
- コスト効率
- 暗号化機能
- HIPAA対応
- アクセス制御機能

### 9.2 Amazon RDS/Aurora の選定理由（リレーショナルデータベース）

**選定技術**: Amazon RDS / Aurora（暗号化必須）

**選定理由**:
1. **マネージドサービス**: バックアップ、パッチ適用、監視が自動化されている
2. **高可用性**: マルチAZ配置、自動フェイルオーバー
3. **暗号化**: 転送時・保存時の暗号化が標準サポート（医療データ必須）
4. **アクセス制御**: VPC内配置、IAM認証対応
5. **監査**: データベース監査ログの有効化
6. **HIPAA対応**: HIPAA Eligible Serviceで、医療データの取り扱いに対応可能

**選定基準**:
- 運用負荷の軽減
- 高可用性
- 暗号化機能
- HIPAA対応
- アクセス制御機能

## 10. 技術選定の総括

### 10.1 選定原則

1. **HIPAA対応の優先**: 医療データの取り扱いに対応するため、HIPAA Eligible Servicesを優先
2. **マネージドサービスの優先**: 運用負荷を軽減し、チームのリソースをビジネスロジックの開発に集中
3. **セキュリティの最優先**: 医療データの保護を最優先とし、暗号化、アクセス制御、監査を標準化
4. **AWSサービスとの統合性**: AWSエコシステム内での統合を優先し、運用の複雑さを軽減
5. **コスト効率**: 適切なコスト最適化オプション（Reserved Instances、Spot Instances等）の活用
6. **スケーラビリティ**: 医療データの大規模処理に対応できるスケーラビリティを確保

### 10.2 医療業界特有の考慮事項

1. **コンプライアンス**: HIPAA、日本の個人情報保護法、医療情報システム安全管理指針等への対応
2. **データ暗号化**: 転送時・保存時の暗号化が必須
3. **アクセス制御**: 最小権限の原則、ロールベースアクセス制御（RBAC）、多要素認証（MFA）の必須化
4. **監査ログ**: データアクセス、設定変更、API呼び出し等、包括的な監査ログの記録
5. **データ保持**: 法的要件に基づくデータ保持期間の管理
6. **災害復旧**: RTO/RPOの定義と、定期的なDRテストの実施

### 10.3 今後の検討事項

- **マルチクラウド対応**: 将来的なマルチクラウド展開を考慮し、Terraform等のマルチクラウド対応ツールを採用
- **エッジコンピューティング**: 医療機器との連携拡張を考慮し、AWS IoT Greengrass等の検討
- **AI/ML機能の強化**: より高度なMLモデル、リアルタイム推論の拡充
- **HPCの拡張**: より大規模な科学計算ワークロードへの対応

## 11. 参考資料

- AWS Well-Architected Framework
- AWS HIPAA Eligible Services
- AWS Security Best Practices
- MLOps Best Practices
- HPC on AWS Best Practices
- Healthcare Information System Security Guidelines（日本の医療情報システム安全管理指針）
