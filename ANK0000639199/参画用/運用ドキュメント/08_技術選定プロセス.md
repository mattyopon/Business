# 技術選定プロセスドキュメント

## 1. 概要

### 1.1 目的
本ドキュメントは、新規プロダクトや機能追加における技術選定のプロセスと判断基準を定義する。

### 1.2 適用範囲
- 新規サービス/機能のアーキテクチャ設計
- 既存システムの技術スタック変更
- ツール/ライブラリの新規導入

---

## 2. 技術選定フレームワーク

### 2.1 選定プロセス

```
┌─────────────────────────────────────────────────────────────────┐
│                  Technology Selection Process                    │
│                                                                   │
│  1. 要件定義         2. 候補洗い出し      3. 評価                │
│  ┌─────────┐        ┌─────────┐        ┌─────────┐             │
│  │ 機能要件 │───────>│ 候補A   │───────>│ PoC実施 │             │
│  │ 非機能要件│        │ 候補B   │        │ スコアリング│         │
│  │ 制約条件 │        │ 候補C   │        │         │             │
│  └─────────┘        └─────────┘        └─────────┘             │
│                                               │                  │
│                                               ▼                  │
│  4. 意思決定          5. ドキュメント化                         │
│  ┌─────────┐        ┌─────────┐                                │
│  │ レビュー │<───────│ ADR作成 │                                │
│  │ 承認    │        │         │                                │
│  └─────────┘        └─────────┘                                │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 役割と責任

| 役割 | 責任 |
|------|------|
| 提案者 | 要件定義、候補洗い出し、PoC実施 |
| アーキテクト | 技術評価、アドバイス、レビュー |
| Tech Lead | 最終判断、承認 |
| セキュリティ | セキュリティ観点でのレビュー |

---

## 3. 評価基準

### 3.1 評価マトリクス

```
評価項目（重み付け）:

┌────────────────────────────────────────────────────────────────┐
│                    Evaluation Matrix                            │
├────────────────────┬──────────────────────────────────────────┤
│ カテゴリ            │ 評価項目                                  │
├────────────────────┼──────────────────────────────────────────┤
│ 技術的適合性 (30%) │ - 要件充足度                              │
│                    │ - パフォーマンス                          │
│                    │ - スケーラビリティ                        │
├────────────────────┼──────────────────────────────────────────┤
│ 運用性 (25%)       │ - 監視・ログ対応                          │
│                    │ - 障害復旧容易性                          │
│                    │ - 自動化対応                              │
├────────────────────┼──────────────────────────────────────────┤
│ セキュリティ (20%) │ - 脆弱性対応                              │
│                    │ - 認証・認可                              │
│                    │ - コンプライアンス                        │
├────────────────────┼──────────────────────────────────────────┤
│ コスト (15%)       │ - 初期コスト                              │
│                    │ - 運用コスト                              │
│                    │ - ライセンス                              │
├────────────────────┼──────────────────────────────────────────┤
│ 組織適合性 (10%)   │ - 既存スキルとの親和性                    │
│                    │ - 学習コスト                              │
│                    │ - コミュニティ・サポート                  │
└────────────────────┴──────────────────────────────────────────┘
```

### 3.2 スコアリング基準

| スコア | 説明 |
|--------|------|
| 5 | 要件を大幅に上回る |
| 4 | 要件を十分に満たす |
| 3 | 要件を満たす |
| 2 | 要件を部分的に満たす |
| 1 | 要件を満たさない |

### 3.3 評価シートテンプレート

```markdown
# 技術選定評価シート

## 基本情報
- **選定対象**: [例: メッセージキュー]
- **評価日**: YYYY-MM-DD
- **評価者**: [名前]

## 候補一覧
| # | 候補 | 概要 |
|---|------|------|
| 1 | Amazon SQS | AWSマネージドキューサービス |
| 2 | Apache Kafka | 分散ストリーミングプラットフォーム |
| 3 | RabbitMQ | オープンソースメッセージブローカー |

## 評価結果

### 技術的適合性 (30%)
| 項目 | SQS | Kafka | RabbitMQ |
|------|-----|-------|----------|
| 要件充足度 | 4 | 5 | 3 |
| パフォーマンス | 3 | 5 | 4 |
| スケーラビリティ | 5 | 5 | 3 |
| **小計** | 12 | 15 | 10 |

### 運用性 (25%)
| 項目 | SQS | Kafka | RabbitMQ |
|------|-----|-------|----------|
| 監視・ログ | 5 | 4 | 3 |
| 障害復旧 | 5 | 3 | 3 |
| 自動化 | 5 | 4 | 3 |
| **小計** | 15 | 11 | 9 |

### セキュリティ (20%)
| 項目 | SQS | Kafka | RabbitMQ |
|------|-----|-------|----------|
| 脆弱性対応 | 5 | 3 | 3 |
| 認証・認可 | 5 | 4 | 4 |
| コンプライアンス | 5 | 3 | 3 |
| **小計** | 15 | 10 | 10 |

### コスト (15%)
| 項目 | SQS | Kafka | RabbitMQ |
|------|-----|-------|----------|
| 初期コスト | 5 | 2 | 4 |
| 運用コスト | 4 | 2 | 3 |
| ライセンス | 5 | 5 | 5 |
| **小計** | 14 | 9 | 12 |

### 組織適合性 (10%)
| 項目 | SQS | Kafka | RabbitMQ |
|------|-----|-------|----------|
| 既存スキル | 5 | 3 | 3 |
| 学習コスト | 5 | 2 | 4 |
| コミュニティ | 4 | 5 | 4 |
| **小計** | 14 | 10 | 11 |

## 総合スコア
| 候補 | 加重スコア | 順位 |
|------|-----------|------|
| SQS | 4.28 | 1 |
| Kafka | 3.55 | 2 |
| RabbitMQ | 3.17 | 3 |

## 推奨
**Amazon SQS** を推奨

### 選定理由
1. マネージドサービスで運用負荷が最小
2. AWS環境との親和性が高い
3. 現状のスループット要件を十分満たす
4. セキュリティ・コンプライアンス対応が容易

### 注意事項
- メッセージ順序保証が必要な場合はFIFOキューを使用
- 大規模ストリーミング要件が出た場合はKafka再検討
```

---

## 4. ADR（Architecture Decision Record）

### 4.1 ADRテンプレート

```markdown
# ADR-XXX: [タイトル]

## ステータス
[Proposed / Accepted / Deprecated / Superseded by ADR-XXX]

## コンテキスト
[この決定が必要になった背景・状況を説明]

## 決定
[採用する技術/アプローチを明記]

## 検討した選択肢

### 選択肢1: [名前]
**説明**: [概要]

**メリット**:
-

**デメリット**:
-

### 選択肢2: [名前]
**説明**: [概要]

**メリット**:
-

**デメリット**:
-

## 理由
[この決定を下した理由]

## 結果
[この決定によって予想される影響]

## 参考資料
- [リンク]
```

### 4.2 ADR例

```markdown
# ADR-001: コンテナオーケストレーションとしてEKSを採用

## ステータス
Accepted

## コンテキスト
医療AIプラットフォームのインフラ基盤として、
コンテナオーケストレーションツールを選定する必要がある。

要件:
- マイクロサービスアーキテクチャのサポート
- 自動スケーリング
- 高可用性
- MLワークロード対応（GPU）

## 決定
Amazon EKS（Elastic Kubernetes Service）を採用する。

## 検討した選択肢

### 選択肢1: Amazon ECS
**説明**: AWS独自のコンテナオーケストレーション

**メリット**:
- シンプルで学習コストが低い
- AWS統合が容易
- Fargateとの親和性

**デメリット**:
- Kubernetesエコシステムが使えない
- ベンダーロックイン
- 複雑なワークフローの表現が困難

### 選択肢2: Amazon EKS
**説明**: マネージドKubernetesサービス

**メリット**:
- 豊富なKubernetesエコシステム
- ポータビリティ（マルチクラウド対応可能）
- MLOpsツールとの統合（Kubeflow等）
- Fargate対応で運用負荷軽減可能

**デメリット**:
- 学習コストが高い
- 運用が複雑になりがち

### 選択肢3: 自前Kubernetes構築
**説明**: EC2上にKubernetesを構築

**メリット**:
- 完全なカスタマイズ性
- コスト最適化の余地

**デメリット**:
- 運用負荷が非常に高い
- コントロールプレーンの管理必要
- セキュリティパッチ適用の負担

## 理由
1. **MLOps対応**: Kubeflow、Seldon等のKubernetesネイティブなMLツールが使える
2. **将来性**: マルチクラウドへの拡張可能性を残す
3. **運用性**: Fargateを活用することでサーバーレス運用が可能
4. **エコシステム**: Helm、ArgoCD等の成熟したツールが利用可能

## 結果
- チームにKubernetes学習が必要（1-2ヶ月のキャッチアップ期間）
- EKS管理コスト（約$72/月/クラスター）が発生
- MLOpsパイプラインの構築が容易になる

## 参考資料
- [Amazon EKS ドキュメント](https://docs.aws.amazon.com/eks/)
- [EKS Best Practices Guide](https://aws.github.io/aws-eks-best-practices/)
```

---

## 5. PoC（Proof of Concept）実施ガイド

### 5.1 PoC計画テンプレート

```markdown
# PoC計画書: [技術名]

## 目的
[PoCで検証したい内容]

## スコープ
### 検証項目
- [ ] 基本機能の動作確認
- [ ] パフォーマンス測定
- [ ] 既存システムとの統合確認
- [ ] 運用性の確認

### 対象外
- [検証対象外の項目]

## 期間
- 開始日: YYYY-MM-DD
- 終了日: YYYY-MM-DD
- 工数: XX人日

## 環境
- AWS環境（開発アカウント）
- リソース: [必要なリソース]

## 成功基準
| 項目 | 基準 |
|------|------|
| レスポンスタイム | P99 < 100ms |
| スループット | > 1000 req/s |
| 可用性 | > 99.9% |

## 成果物
- PoC環境
- 検証結果レポート
- 推奨事項
```

### 5.2 PoC実施チェックリスト

```markdown
## PoC実施チェックリスト

### 準備フェーズ
- [ ] PoC計画書の承認
- [ ] 環境構築完了
- [ ] テストデータ準備
- [ ] 監視設定

### 実施フェーズ
- [ ] 基本機能テスト
- [ ] 負荷テスト
- [ ] 障害テスト（障害注入）
- [ ] セキュリティテスト

### 評価フェーズ
- [ ] メトリクス収集
- [ ] 結果分析
- [ ] レポート作成
- [ ] レビュー実施

### クリーンアップ
- [ ] 環境削除
- [ ] コスト確認
- [ ] ナレッジ共有
```

---

## 6. 技術選定ガイドライン

### 6.1 推奨技術スタック

| カテゴリ | 推奨 | 代替 | 備考 |
|---------|------|------|------|
| コンテナオーケストレーション | EKS (Fargate) | ECS | 大規模・複雑な場合はEKS |
| データベース | Aurora MySQL | RDS MySQL | 高可用性要件ならAurora |
| キャッシュ | ElastiCache (Redis) | DynamoDB DAX | セッション、キャッシュ用途 |
| メッセージキュー | SQS | Kafka (MSK) | ストリーミング要件ならKafka |
| CI/CD | GitHub Actions | CodePipeline | GitHub利用の場合 |
| IaC | Terraform | CloudFormation | マルチクラウド考慮 |
| 監視 | Prometheus + Grafana | CloudWatch | K8s環境ならPrometheus |

### 6.2 避けるべきアンチパターン

| アンチパターン | 問題 | 推奨 |
|---------------|------|------|
| 新技術の早期採用 | 安定性・サポート不足 | GA後1年以上経過したものを選定 |
| 過度なマイクロサービス | 運用複雑化 | 適切な粒度で分割 |
| 自前実装 | 車輪の再発明 | マネージドサービス活用 |
| ベンダーロックイン | 将来の柔軟性欠如 | 抽象化レイヤーを設ける |

---

## 7. レビュー・承認プロセス

### 7.1 レビュー観点

| 観点 | チェック項目 |
|------|-------------|
| 技術的妥当性 | 要件を満たすか、オーバースペックでないか |
| セキュリティ | 脆弱性、コンプライアンス対応 |
| コスト | 予算内か、隠れコストはないか |
| 運用性 | 既存運用体制で対応可能か |
| チーム対応 | 必要スキルは確保できるか |

### 7.2 承認フロー

```
提案者 → アーキテクトレビュー → セキュリティレビュー → Tech Lead承認
           (技術評価)            (セキュリティ評価)      (最終判断)
```

### 7.3 承認基準

| 影響範囲 | 承認者 | 所要日数目安 |
|---------|--------|-------------|
| 局所的（1サービス） | アーキテクト | 3日 |
| 中規模（複数サービス） | Tech Lead | 1週間 |
| 大規模（プラットフォーム全体） | CTO | 2週間 |

---

## 8. 変更履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|--------|
| 2026-01-XX | 1.0 | 初版作成 | - |
