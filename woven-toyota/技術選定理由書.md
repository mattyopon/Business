# 技術選定理由書 - ウーブン・バイ・トヨタ案件

## 1. 概要

本資料は、スマートシティ向けAIアプリケーション開発におけるインフラ技術選定の理由と根拠を説明します。各技術スタックを選定した背景、考慮した代替案、選定基準を明確にしています。

## 2. クラウドプラットフォーム選定

### 2.1 AWS の選定理由

**選定技術**: Amazon Web Services (AWS)

**選定理由**:
1. **豊富なマネージドサービス**: EKS、RDS、S3、Lambda等、多様なマネージドサービスが提供されており、運用負荷を軽減できる
2. **高い可用性とスケーラビリティ**: マルチAZ対応、自動スケーリング機能が充実しており、スマートシティの大規模データ処理に対応可能
3. **成熟したエコシステム**: 豊富なドキュメント、コミュニティ、サードパーティツールが充実
4. **セキュリティ機能**: IAM、KMS、GuardDuty等、セキュリティ機能が標準で提供されている
5. **コスト効率**: 従量課金モデル、Reserved Instances、Spot Instances等、柔軟なコスト最適化オプション
6. **国内リージョン対応**: 東京リージョン（ap-northeast-1）が存在し、レイテンシ要件に対応可能

**代替案との比較**:
- **Microsoft Azure**: エンタープライズ向けの機能が充実しているが、KubernetesのサポートがAWS EKSほど成熟していない
- **Google Cloud Platform (GCP)**: GKE（Google Kubernetes Engine）は強力だが、日本国内での事例やコミュニティがAWSと比較して少ない
- **オンプレミス**: 初期コストが高く、スケーリングに時間がかかるため、クラウドネイティブな要件には不向き

**選定基準**:
- マネージドサービスの充実度
- コミュニティとサポート体制
- コスト効率
- スケーラビリティ
- セキュリティ機能

## 3. コンテナオーケストレーション選定

### 3.1 Amazon EKS の選定理由

**選定技術**: Amazon Elastic Kubernetes Service (EKS)

**選定理由**:
1. **マネージドKubernetes**: コントロールプレーンの運用が不要で、運用チームの負荷を軽減
2. **Kubernetes標準準拠**: CNCF（Cloud Native Computing Foundation）認定のKubernetesディストリビューションで、標準的なKubernetes APIを使用可能
3. **高可用性**: マルチAZ対応のコントロールプレーンが自動で提供される
4. **AWSサービスとの統合**: IAM（IRSA）、ALB、CloudWatch等、AWSサービスとの統合が容易
5. **スケーリング**: Cluster Autoscaler、Horizontal Pod Autoscaler等、柔軟なスケーリングが可能
6. **セキュリティ**: ネットワークポリシー、Podセキュリティ標準、Secrets管理が標準サポート

**代替案との比較**:
- **Amazon ECS**: よりシンプルだが、Kubernetesの豊富なエコシステム（Helm、Istio、Prometheus等）が利用できない
- **セルフマネージドKubernetes (kops、kubeadm)**: 運用負荷が高く、コントロールプレーンの管理が必要
- **Google GKE**: 強力だが、AWSサービスとの統合がEKSほど容易ではない

**選定基準**:
- 運用負荷の軽減
- Kubernetes標準への準拠
- AWSサービスとの統合性
- スケーラビリティ
- エコシステムの豊富さ

## 4. CI/CDパイプライン選定

### 4.1 GitHub Actions の選定理由

**選定技術**: GitHub Actions

**選定理由**:
1. **コードリポジトリと統合**: GitHubリポジトリと同一プラットフォームで、シームレスな統合が可能
2. **マネージドサービス**: インフラ管理が不要で、設定が比較的シンプル
3. **無料枠**: パブリックリポジトリは無料、プライベートリポジトリも月2,000分の無料枠がある
4. **豊富なアクション**: コミュニティが提供するアクションが豊富（Docker、AWS、Kubernetes等）
5. **並列実行**: ジョブの並列実行が可能で、パイプラインの高速化が図れる
6. **マトリックスビルド**: 複数の環境（OS、ランタイムバージョン等）での並列テストが容易

**代替案との比較**:
- **Jenkins**: 柔軟性が高いが、セルフホスト型で運用負荷が高い。設定が複雑
- **GitLab CI**: GitLabと統合されているが、GitHubを使用している場合は別プラットフォームの管理が必要
- **CircleCI**: 強力だが、GitHub Actionsと比較してコストが高い
- **AWS CodePipeline**: AWSサービスとの統合は良好だが、GitHubとの統合がGitHub Actionsほどシームレスではない

**選定基準**:
- コードリポジトリとの統合性
- 運用負荷の軽減
- コスト効率
- 拡張性
- コミュニティの充実度

## 5. Infrastructure as Code (IaC) 選定

### 5.1 Terraform の選定理由（推奨）

**選定技術**: Terraform

**選定理由**:
1. **マルチクラウド対応**: AWS以外のクラウド（GCP、Azure）にも対応し、将来的な拡張性がある
2. **宣言的言語**: HCL（HashiCorp Configuration Language）でインフラを宣言的に記述できる
3. **豊富なプロバイダー**: AWS、Kubernetes、GitHub等、豊富なプロバイダーが利用可能
4. **状態管理**: Terraform状態ファイルにより、現在のインフラ状態を追跡可能
5. **モジュール化**: 再利用可能なモジュール設計が可能で、コードの保守性が高い
6. **Plan機能**: 実行前の変更内容を確認できるため、安全性が高い

**代替案との比較**:
- **AWS CloudFormation**: AWS専用で強力だが、マルチクラウド対応ができない。YAML/JSONが冗長になりがち
- **AWS CDK (Cloud Development Kit)**: TypeScript/Python等のプログラミング言語で定義できるが、学習コストが高い
- **Pulumi**: プログラミング言語で定義できるが、Terraformと比較してコミュニティが小さい

**選定基準**:
- マルチクラウド対応性
- 学習コスト
- コミュニティとサポート
- コードの保守性
- 状態管理機能

### 5.2 AWS CloudFormation の選定理由（代替案）

**選定技術**: AWS CloudFormation

**選定理由**（CloudFormationを選ぶ場合）:
1. **AWSネイティブ**: AWSサービスとの統合が非常に良好
2. **変更セット**: 変更内容を実行前に確認できる
3. **スタック管理**: リソースの依存関係を自動で管理
4. **ロールバック**: スタックのロールバックが自動でサポートされている
5. **AWS SAM**: サーバーレスアプリケーションの定義が容易

**選定基準**:
- AWS専用環境での利用が前提の場合
- AWS標準ツールでの統一性を重視する場合

## 6. データ処理パイプライン選定

### 6.1 パイプラインオーケストレーション技術

#### 6.1.1 Apache Airflow の選定理由（推奨）

**選定技術**: Apache Airflow（Kubernetes上で実行）

**選定理由**:
1. **Pythonベース**: PythonでDAG（Directed Acyclic Graph）を定義でき、柔軟性が高い
2. **豊富なオペレーター**: AWS、Kubernetes、データベース等、多様なオペレーターが利用可能
3. **スケーラビリティ**: KubernetesExecutorにより、Kubernetesクラスターのリソースを活用可能
4. **UI**: Web UIでワークフローの実行状況を可視化できる
5. **コミュニティ**: オープンソースで、コミュニティが大きく活発
6. **バージョン管理**: DAGをコードとして管理でき、Gitでバージョン管理可能

**代替案との比較**:
- **AWS Step Functions**: AWSネイティブで統合しやすいが、Kubernetes環境との統合がAirflowほど柔軟ではない
- **Kubeflow Pipelines**: Kubernetesネイティブだが、主にMLワークフローに特化している
- **Argo Workflows**: Kubernetesネイティブで軽量だが、UIや機能がAirflowと比較してシンプル

**選定基準**:
- 柔軟性と拡張性
- Kubernetes環境との統合性
- コミュニティとサポート
- 可視化機能
- 学習コスト

#### 6.1.2 AWS Step Functions の選定理由（代替案）

**選定理由**（Step Functionsを選ぶ場合）:
1. **AWSネイティブ**: AWSサービスとの統合が非常に良好（Lambda、ECS、SageMaker等）
2. **サーバーレス**: インフラ管理が不要で、自動スケーリング
3. **視覚的なワークフロー**: ワークフローを視覚的に定義・確認できる
4. **コスト効率**: 実行時間とステート遷移数に基づく従量課金で、小規模ワークフローに有利

**選定基準**:
- AWSサービス中心のワークフロー
- サーバーレスアーキテクチャの採用
- シンプルなワークフロー

### 6.2 データストレージ選定

#### 6.2.1 Amazon S3 の選定理由（データレイク）

**選定技術**: Amazon S3

**選定理由**:
1. **スケーラビリティ**: 無制限のストレージ容量、99.999999999%（11 9's）の耐久性
2. **コスト効率**: ストレージクラス（Standard、Intelligent-Tiering、Glacier等）により、コスト最適化が可能
3. **ライフサイクルポリシー**: データの自動階層化・アーカイブ・削除が可能
4. **バージョニング**: オブジェクトのバージョン管理が標準サポート
5. **統合性**: AWSサービス（Redshift、Athena、EMR等）との統合が容易
6. **セキュリティ**: 暗号化（SSE-S3、SSE-KMS、SSE-C）、アクセス制御（IAM、バケットポリシー）

**選定基準**:
- スケーラビリティ
- コスト効率
- 耐久性と可用性
- AWSサービスとの統合性

#### 6.2.2 Amazon RDS/Aurora の選定理由（リレーショナルデータベース）

**選定技術**: Amazon RDS / Aurora

**選定理由**:
1. **マネージドサービス**: バックアップ、パッチ適用、監視が自動化されている
2. **高可用性**: マルチAZ配置、自動フェイルオーバー
3. **スケーリング**: 読み取りレプリカ、自動スケーリング（Aurora Serverless v2）
4. **パフォーマンス**: Auroraは高パフォーマンス（最大15個の読み取りレプリカ、低レイテンシ）
5. **セキュリティ**: 暗号化、VPC内配置、IAM認証対応

**選定基準**:
- 運用負荷の軽減
- 高可用性
- パフォーマンス
- セキュリティ

#### 6.2.3 Amazon DynamoDB の選定理由（NoSQLデータベース）

**選定技術**: Amazon DynamoDB

**選定理由**:
1. **サーバーレス**: 容量管理が不要で、自動スケーリング
2. **低レイテンシ**: シングル桁ミリ秒のレイテンシ
3. **高可用性**: マルチAZ対応、自動レプリケーション
4. **コスト効率**: オンデマンドモードとプロビジョンドモードで柔軟な課金
5. **AWSサービスとの統合**: Lambda、API Gateway等との統合が容易

**選定基準**:
- 低レイテンシ要件
- 自動スケーリング
- サーバーレスアーキテクチャ
- コスト効率

## 7. 監視・ロギング選定

### 7.1 Amazon CloudWatch の選定理由

**選定技術**: Amazon CloudWatch

**選定理由**:
1. **AWSネイティブ**: AWSリソースのメトリクスが自動で収集される
2. **統合性**: 他のAWSサービス（Lambda、ECS、RDS等）との統合がシームレス
3. **アラート**: CloudWatch Alarmsによるアラート設定が容易
4. **ログ管理**: CloudWatch Logsによる統合ログ管理
5. **ダッシュボード**: カスタムダッシュボードの作成が容易

**選定基準**:
- AWSサービスとの統合性
- 運用負荷の軽減
- コスト効率

### 7.2 Prometheus + Grafana の選定理由

**選定技術**: Prometheus + Grafana

**選定理由**:
1. **Kubernetes標準**: Kubernetesのメトリクス収集に標準的に使用される
2. **柔軟なクエリ言語**: PromQLによる柔軟なクエリ
3. **豊富な可視化**: Grafanaによる高機能なダッシュボード
4. **オープンソース**: コストがかからず、カスタマイズ可能
5. **エコシステム**: 豊富なエクスポーター（Node Exporter、cAdvisor等）

**選定基準**:
- Kubernetes環境での標準的な監視
- 柔軟性とカスタマイズ性
- コスト効率

## 8. セキュリティ選定

### 8.1 AWS Secrets Manager の選定理由

**選定技術**: AWS Secrets Manager

**選定理由**:
1. **自動ローテーション**: データベース認証情報等の自動ローテーション
2. **AWS統合**: Lambda、RDS等との統合が容易
3. **暗号化**: KMSによる暗号化が標準
4. **監査**: CloudTrailによるアクセスログ
5. **コスト**: シークレット数とAPI呼び出し数に基づく従量課金

**代替案との比較**:
- **HashiCorp Vault**: より高機能だが、セルフホスト型で運用負荷が高い
- **AWS Systems Manager Parameter Store**: よりシンプルで低コストだが、自動ローテーション機能がない

**選定基準**:
- 自動ローテーション機能
- AWSサービスとの統合性
- 運用負荷の軽減

## 9. 技術選定の総括

### 9.1 選定原則

1. **マネージドサービスの優先**: 運用負荷を軽減し、チームのリソースをビジネスロジックの開発に集中
2. **AWSサービスとの統合性**: AWSエコシステム内での統合を優先し、運用の複雑さを軽減
3. **オープンスタンダードの採用**: Kubernetes、Prometheus等、オープンスタンダードを採用し、ベンダーロックインを回避
4. **スケーラビリティ**: スマートシティの大規模データ処理に対応できるスケーラビリティを確保
5. **コスト効率**: 適切なコスト最適化オプション（Reserved Instances、Spot Instances等）の活用

### 9.2 今後の検討事項

- **マルチクラウド対応**: 将来的なマルチクラウド展開を考慮し、Terraform等のマルチクラウド対応ツールを採用
- **エッジコンピューティング**: IoTデバイスとの連携拡張を考慮し、AWS IoT Greengrass等の検討
- **AI/ML機能の強化**: より高度なMLモデルの運用を考慮し、SageMaker、Kubeflow等の検討

## 10. 参考資料

- AWS Well-Architected Framework
- CNCF Cloud Native Landscape
- Kubernetes Best Practices
- Terraform Best Practices
- Apache Airflow Documentation
